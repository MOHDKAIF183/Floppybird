<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Floppy bird game</title>
    <link rel="stylesheet" href="style.css">
   <link rel="shortcut icon" href="https://github.com/ImKennyYip/flappy-bird/blob/master/flappybird.png?raw=true" type="image/x-icon">
    <style>
        body{
            margin: 0;
            font-family: 'Courier New', Courier, monospace;
            background: #222;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 16px;
            box-sizing: border-box;
            text-align: center;
        }

        .game-wrapper{
            width: 100%;
            max-width: 1280px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #board{
            background-image: url("https://github.com/ImKennyYip/flappy-bird/blob/master/flappybirdbg.png?raw=true");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;

  
            width: 100%;
            max-width: 1280px;
            height: auto;
            max-height: 80vh;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.6);
        }

        /* Tablet & small laptop */
        @media (max-width: 1024px){
            body{
                padding: 12px;
            }
            #board{
                max-height: 75vh;
                box-shadow: 0 8px 24px rgba(0,0,0,0.5);
            }
        }

        /* Large phones & portrait tablets */
        @media (max-width: 768px){
            body{
                padding: 10px;
            }
            #board{
                max-height: 70vh;
                border-radius: 6px;
            }
        }

        /* Small phones */
        @media (max-width: 480px){
            body{
                padding: 8px;
            }
            #board{
                max-height: 65vh;
                border-radius: 4px;
                box-shadow: 0 6px 18px rgba(0,0,0,0.5);
            }
        }
    </style>
  
</head>
    
<body>
    <div class="game-wrapper">
        <canvas id="board"></canvas>
    </div>
   <script>
    let board;
    let boardWidth = 1280;
    let boardHeight = 640;
    let context;

    let birdWidth = 34;
    let birdHeight = 24;
    let birdX = boardWidth / 8;
    let birdY = boardHeight / 2;
    let birdImg =[];
    let birdImgsIndex= 0;

    let bird = {
        x: birdX,
        y: birdY,
        width: birdWidth,
        height: birdHeight
    };

    let pipeArray = [];
    let pipeWidth = 64;
    let pipeHeight = 512;
    let pipeX = boardWidth;
    let pipeY = 0;

    let topPipeImg;
    let bottomPipeImg;

    let velocityX = -2;
    let velocityY = 0;
    let gravity = 0.4;

    let gameOver = false;
    let score = 0;
    let bestScore = parseInt(localStorage.getItem("floppyBestScore") || "0");



   window.onload = function () {
    board = document.getElementById("board");
    board.height = boardHeight;
    board.width = boardWidth;
    context = board.getContext("2d");

    birdImg = new Image();
    birdImg.src = "https://github.com/ImKennyYip/flappy-bird/blob/master/flappybird.png?raw=true";
    birdImg.onload = function () {
        context.drawImage(birdImg, bird.x, bird.y, bird.width, bird.height);
    };

    for (let i = 0; i < 4; i++) {
        let birdImg = new Image();
    }

    topPipeImg = new Image();
    topPipeImg.src = "https://github.com/ImKennyYip/flappy-bird/blob/master/toppipe.png?raw=true";

    bottomPipeImg = new Image();
    bottomPipeImg.src = "https://github.com/ImKennyYip/flappy-bird/blob/master/bottompipe.png?raw=true";

    requestAnimationFrame(update);

    setInterval(placePipes, 1500);

   
    document.addEventListener("keydown", moveBird);
    document.addEventListener("touchstart", moveBird);
    document.addEventListener("click", moveBird);
};

    function update() {
        requestAnimationFrame(update);

        if (gameOver ){
            return;
        }
        context.clearRect(0, 0, board.width, board.height);

        velocityY += gravity;
        bird.y = Math.max(bird.y += velocityY, 0);
        context.drawImage(birdImg, bird.x, bird.y, bird.width, bird.height);

        if(bird.y > boardHeight){
            gameOver = true;
        }

        for (let i = 0; i < pipeArray.length; i++) {
            let pipe = pipeArray[i];
            pipe.x += velocityX;
            context.drawImage(pipe.img, pipe.x, pipe.y, pipe.width, pipe.height);
            
            if(!pipe.passed && bird.x > pipe.x + pipe.width){
                score += 0.5;
                pipe.passed = true;
            }

            if(detectCollision(bird , pipe)){
                gameOver = true;
            }
        }

        while(pipeArray.length > 0 && pipeArray[0].x < -pipeWidth){
            pipeArray.shift();
        }

        context.fillStyle = "black";
        context.font = "45px sans-serif" ;
        context.fillText(score , 5 , 45);

        if(gameOver){
            // Update best score
            if (score > bestScore) {
                bestScore = score;
                localStorage.setItem("floppyBestScore", bestScore);
            }

            // Draw best score before "Khel Khatam"
            context.font = "32px sans-serif";
            context.fillText("Best: " + bestScore, 5, 90);

            context.font = "45px sans-serif";
            context.fillText("Khel Khatam ", 5, 140);
        }
    }

    function placePipes() {
        if(gameOver){
            return ;
        }

        let randomPipeY = pipeY - pipeHeight / 4 - Math.random() * pipeHeight / 2;
        let openingSpace = board.height / 4;

        let topPipe = {
            img: topPipeImg,
            x: pipeX,
            y: randomPipeY,
            width: pipeWidth,
            height: pipeHeight,
            passed: false
        };

        pipeArray.push(topPipe);

        let bottomPipe = {
            img: bottomPipeImg,
            x: pipeX,
            y: randomPipeY + pipeHeight + openingSpace,
            width: pipeWidth,
            height: pipeHeight,
            passed: false
        };

        pipeArray.push(bottomPipe); 
    }

  function moveBird(e){
    if(!e.code || e.code =="Space" || e.code == "ArrowUp" || e.code == "KeyX" ){
        velocityY = -6;

        if(gameOver){
            bird.y = birdY;
            pipeArray = []
            score = 0;
            gameOver = false;
        }
    }
}

function detectCollision(a, b){
    return a.x < b.x + b.width && 
           a.x + a.width > b.x &&
           a.y < b.y + b.height &&    
           a.y + a.height > b.y;
}

</script>

    </body>
</html>